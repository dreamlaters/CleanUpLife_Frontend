<!-- ç‰©å“ç®¡ç†é¡µé¢ -->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px">
    <view class="navbar-content">
      <text class="navbar-title">æˆ‘çš„ç‰©å“</text>
    </view>
  </view>
  <view class="navbar-placeholder" style="height: {{navbarHeight}}px"></view>

  <!-- é¡¶éƒ¨Tabåˆ‡æ¢ -->
  <view class="top-tabs">
    <view class="top-tab {{currentTab === 'items' ? 'top-tab-active' : ''}}" bindtap="switchTab" data-tab="items">
      <text class="top-tab-icon">ğŸ“¦</text>
      <text class="top-tab-text">ç‰©å“ç®¡ç†</text>
      <view class="top-tab-badge" wx:if="{{products.length}}">{{products.length}}</view>
    </view>
    <view class="top-tab {{currentTab === 'tobuy' ? 'top-tab-active' : ''}}" bindtap="switchTab" data-tab="tobuy">
      <text class="top-tab-icon">ğŸ›’</text>
      <text class="top-tab-text">å¾…è´­æ¸…å•</text>
      <view class="top-tab-badge" wx:if="{{toBuyPending.length}}">{{toBuyPending.length}}</view>
    </view>
  </view>

  <!-- ç‰©å“ç®¡ç†å†…å®¹ -->
  <view class="tab-content" wx:if="{{currentTab === 'items'}}">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-row">
      <view class="stat-mini stat-primary">
        <text class="stat-mini-value">{{products.length}}</text>
        <text class="stat-mini-label">æ€»æ•°</text>
      </view>
      <view class="stat-mini stat-warning">
        <text class="stat-mini-value">{{expiringSoonCount}}</text>
        <text class="stat-mini-label">å³å°†è¿‡æœŸ</text>
      </view>
      <view class="stat-mini stat-danger">
        <text class="stat-mini-value">{{expiredCount}}</text>
        <text class="stat-mini-label">å·²è¿‡æœŸ</text>
      </view>
    </view>

    <!-- ç­›é€‰æ ‡ç­¾ -->
    <scroll-view scroll-x class="filter-scroll" wx:if="{{products.length}}">
      <view class="filter-tabs">
        <view class="filter-tab {{currentFilter === 'all' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="all">å…¨éƒ¨</view>
        <view class="filter-tab {{currentFilter === 'Food' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="Food">ğŸ¥– é£Ÿç‰©</view>
        <view class="filter-tab {{currentFilter === 'CatFood' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="CatFood">ğŸ± çŒ«ç²®</view>
        <view class="filter-tab {{currentFilter === 'Medicine' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="Medicine">ğŸ’Š è¯å“</view>
      </view>
    </scroll-view>

    <!-- ç‰©å“åˆ—è¡¨ -->
    <view class="section-card">
      <view class="loading-container" wx:if="{{loadingProducts}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      
      <view class="item-list" wx:elif="{{filteredProducts.length}}">
        <view 
          class="item-card"
          wx:for="{{filteredProducts}}" 
          wx:key="id"
          data-id="{{item.id}}"
          data-category="{{item.category}}"
          bindtap="onUpdate"
          bindlongpress="showItemActions"
        >
          <view class="item-emoji">{{item.emoji || 'ğŸ“¦'}}</view>
          <view class="item-content">
            <text class="item-name">{{item.name}}</text>
            <view class="item-info">
              <text class="item-location">ğŸ“ {{item.location.roomPlacement}}</text>
              <text class="item-date-badge {{item.dateClass}}">{{item.bestByFormatted}}</text>
            </view>
          </view>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!loadingProducts && !products.length}}">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-title">è¿˜æ²¡æœ‰æ·»åŠ ç‰©å“</text>
        <text class="empty-text">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå¼€å§‹è®°å½•ä½ çš„ç‰©å“</text>
        <view class="empty-btn" bindtap="goToAddItem">+ æ·»åŠ ç‰©å“</view>
      </view>
    </view>
  </view>

  <!-- å¾…è´­æ¸…å•å†…å®¹ -->
  <view class="tab-content" wx:if="{{currentTab === 'tobuy'}}">
    <view class="section-card">
      <view class="loading-container" wx:if="{{loadingToBuy}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- æœªå®Œæˆåˆ—è¡¨ -->
      <view class="item-list" wx:elif="{{toBuyPending.length}}">
        <view 
          class="item-card tobuy-item"
          wx:for="{{toBuyPending}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onUpdateToBuy"
          bindlongpress="showToBuyActions"
        >
          <view class="tobuy-checkbox {{item.completed ? 'tobuy-checkbox-checked' : ''}}" 
                catchtap="toggleToBuyComplete" data-id="{{item.id}}">
            <text wx:if="{{item.completed}}">âœ“</text>
          </view>
          <view class="item-content">
            <text class="item-name">{{item.name}}</text>
            <view class="item-info">
              <view class="priority-badge priority-{{item.priority <= 3 ? 'high' : item.priority <= 7 ? 'medium' : 'low'}}">
                P{{item.priority}}
              </view>
            </view>
          </view>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!loadingToBuy && !toBuyProducts.length}}">
        <text class="empty-icon">ğŸ›’</text>
        <text class="empty-title">è´­ç‰©æ¸…å•æ˜¯ç©ºçš„</text>
        <text class="empty-text">è®°å½•éœ€è¦è´­ä¹°çš„ç‰©å“</text>
        <view class="empty-btn" bindtap="goToAddToBuy">+ æ·»åŠ å¾…è´­</view>
      </view>
    </view>

    <!-- å·²å®Œæˆçš„å¾…è´­ç‰©å“ -->
    <view class="section-card completed-section" wx:if="{{toBuyCompleted.length}}">
      <view class="completed-header" bindtap="toggleCompletedList">
        <view class="completed-title-wrap">
          <text class="completed-icon">âœ…</text>
          <text class="completed-title">å·²å®Œæˆ ({{toBuyCompleted.length}})</text>
        </view>
        <view class="completed-actions">
          <view class="clear-btn" catchtap="clearCompletedToBuy">æ¸…é™¤</view>
          <text class="expand-icon {{showCompleted ? 'expand-icon-up' : ''}}">â€º</text>
        </view>
      </view>
      
      <view class="completed-list {{showCompleted ? 'completed-list-show' : ''}}">
        <view 
          class="item-card tobuy-item item-card-completed"
          wx:for="{{toBuyCompleted}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onUpdateToBuy"
          bindlongpress="showToBuyActions"
        >
          <view class="tobuy-checkbox tobuy-checkbox-checked" 
                catchtap="toggleToBuyComplete" data-id="{{item.id}}">
            <text>âœ“</text>
          </view>
          <view class="item-content item-completed">
            <text class="item-name">{{item.name}}</text>
          </view>
          <text class="item-arrow">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab-btn" bindtap="{{currentTab === 'items' ? 'goToAddItem' : 'goToAddToBuy'}}">
    <text class="fab-icon">+</text>
  </view>

  <!-- åº•éƒ¨æ¶ˆæ¯æ¨é€å…¥å£ -->
  <view class="footer-link-wrap">
    <navigator url="/pages/openid/openid" class="footer-link">
      <text class="footer-link-icon">ğŸ””</text>
      <text class="footer-link-text">æ¶ˆæ¯æ¨é€è®¾ç½®</text>
      <text class="footer-link-arrow">â€º</text>
    </navigator>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒº -->
  <view class="safe-bottom"></view>
</view>

<!-- æ“ä½œèœå• -->
<view class="action-overlay {{showActionSheet ? 'show' : ''}}" bindtap="hideActionSheet" wx:if="{{showActionSheet}}">
  <view class="action-sheet" catchtap="">
    <view class="action-header">
      <text class="action-title">{{actionSheetTitle}}</text>
    </view>
    <view class="action-item" bindtap="onActionEdit">
      <text class="action-icon">âœï¸</text>
      <text class="action-text">ç¼–è¾‘</text>
    </view>
    <view class="action-item action-danger" bindtap="onActionDelete">
      <text class="action-icon">ğŸ—‘ï¸</text>
      <text class="action-text">åˆ é™¤</text>
    </view>
    <view class="action-cancel" bindtap="hideActionSheet">å–æ¶ˆ</view>
  </view>
</view>
