<!-- é¦–é¡µå±•ç¤ºç‰©å“åˆ—è¡¨å’Œæé†’åŠŸèƒ½ -->
<view class="container">
  <!-- ç‰©å“ç®¡ç†åŒºåŸŸ -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ“¦ æˆ‘çš„ç‰©å“</text>
    </view>
    
    <!-- ç‰©å“è¡¨æ ¼ -->
    <view class="product-table">
      <!-- è¡¨å¤´ -->
      <view class="table-row table-header">
        <view class="table-cell" bindtap="onSortByName">
          <text>ç‰©å“åç§°</text>
          <text class="sort-icon">â†•</text>
        </view>
        <view class="table-cell col-date" bindtap="onSortByBestBy">
          <text>ä¿è´¨æœŸ</text>
          <text class="sort-icon">â†•</text>
        </view>
        <view class="table-cell col-location">
          <text>å­˜æ”¾ä½ç½®</text>
        </view>
      </view>
      
      <!-- æ•°æ®è¡Œ -->
      <scroll-view scroll-y="true" class="table-scroll-view" wx:if="{{products.length}}">
        <view 
          wx:for="{{products}}" 
          wx:key="id" 
          class="swipe-row" 
          data-show="{{swipeIndex == index}}"
        >
          <view class="swipe-actions">
            <button class="swipe-btn delete-btn" data-id="{{item.id}}" catchtap="onDelete">åˆ é™¤</button>
            <button class="swipe-btn update-btn" data-id="{{item.id}}" data-category="{{item.category}}" catchtap="onUpdate">ç¼–è¾‘</button>
          </view>
          <view 
            class="table-row product-card swipe-content"
            bindtouchstart="onTouchStart"
            bindtouchmove="onTouchMove"
            bindtouchend="onTouchEnd"
            data-index="{{index}}"
          >
            <view class="table-cell name-cell">
              <text class="product-name">{{item.name}} {{item.emoji}}</text>
            </view>
            <view class="table-cell col-date">
              <text class="product-date {{item.dateClass}}">{{item.bestByFormatted}}</text>
            </view>
            <view class="table-cell col-location">
              <text class="location-tag">{{item.location.roomPlacement}}-{{item.location.site}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!products.length}}">
        <text class="empty-icon">ğŸ“­</text>
        <text>æš‚æ— ç‰©å“ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </text>
      </view>
    </view>
    
    <!-- æ·»åŠ æŒ‰é’® -->
    <view class="add-btn-row">
      <view class="fab-btn" bindtap="goToTarget">
        <text class="fab-btn-icon">+</text>
      </view>
    </view>
  </view>

  <!-- å¾…è´­ç‰©å“åŒºåŸŸ -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ›’ å¾…è´­æ¸…å•</text>
    </view>
    
    <view class="product-table">
      <view class="table-row table-header">
        <view class="table-cell" style="flex: 2;">ç‰©å“åç§°</view>
        <view class="table-cell" style="flex: 1;">ä¼˜å…ˆçº§</view>
      </view>
      
      <scroll-view scroll-y="true" class="table-scroll-view" wx:if="{{toBuyProducts.length}}">
        <view 
          wx:for="{{toBuyProducts}}" 
          wx:key="id" 
          class="swipe-row" 
          data-show="{{toBuySwipeIndex == index}}"
        >
          <view class="swipe-actions">
            <button class="swipe-btn delete-btn" data-id="{{item.id}}" catchtap="onDeleteToBuy">åˆ é™¤</button>
            <button class="swipe-btn update-btn" data-id="{{item.id}}" catchtap="onUpdateToBuy">ç¼–è¾‘</button>
          </view>
          <view 
            class="table-row product-card swipe-content"
            bindtouchstart="onTouchStartToBuy"
            bindtouchmove="onTouchMoveToBuy"
            bindtouchend="onTouchEndToBuy"
            data-index="{{index}}"
          >
            <view class="table-cell name-cell" style="flex: 2;">
              <text class="product-name">{{item.name}}</text>
            </view>
            <view class="table-cell" style="flex: 1;">
              <text class="priority-badge">{{item.priority}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <view class="empty-state" wx:if="{{!toBuyProducts.length}}">
        <text class="empty-icon">ğŸ›’</text>
        <text>æš‚æ— å¾…è´­ç‰©å“</text>
      </view>
    </view>
    
    <view class="add-btn-row">
      <view class="fab-btn" bindtap="goToAddToBuy">
        <text class="fab-btn-icon">+</text>
      </view>
    </view>
  </view>

  <!-- å‡ºè¡Œç›®çš„åœ°åŒºåŸŸ -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">âœˆï¸ å‡ºè¡Œè®¡åˆ’</text>
    </view>
    
    <!-- Tabåˆ‡æ¢ -->
    <view class="travel-tabs">
      <view 
        class="travel-tab {{travelTab === 'pending' ? 'travel-tab-active' : ''}}" 
        bindtap="switchTravelTab" 
        data-tab="pending"
      >
        å¾…å‡ºè¡Œ
      </view>
      <view 
        class="travel-tab {{travelTab === 'visited' ? 'travel-tab-active' : ''}}" 
        bindtap="switchTravelTab" 
        data-tab="visited"
      >
        å·²å‡ºè¡Œ
      </view>
    </view>

    <!-- æ–°å¢è¡¨å• -->
    <view class="travel-add-form" wx:if="{{showTravelForm}}">
      <view class="travel-form-row">
        <text class="travel-form-label">ç›®çš„åœ°ç±»å‹</text>
        <picker mode="selector" range="{{['å›½å†…', 'å›½å¤–']}}" value="{{travelFormTypeIndex}}" bindchange="onTravelTypeChange">
          <view class="travel-form-picker">{{travelFormTypeIndex === 0 ? 'ğŸ‡¨ğŸ‡³ å›½å†…' : 'ğŸŒ å›½å¤–'}}</view>
        </picker>
      </view>
      
      <!-- å›½å†…é€‰æ‹©çœå¸‚ -->
      <view class="travel-form-row" wx:if="{{travelFormTypeIndex === 0}}">
        <text class="travel-form-label">çœå¸‚</text>
        <picker mode="region" level="city" value="{{travelRegion}}" bindchange="onRegionChange">
          <view class="travel-form-picker">{{travelRegionDisplay || 'è¯·é€‰æ‹©çœå¸‚'}}</view>
        </picker>
      </view>
      
      <!-- å›½å¤–é€‰æ‹©å›½å®¶ -->
      <view class="travel-form-row" wx:if="{{travelFormTypeIndex === 1}}">
        <text class="travel-form-label">å›½å®¶</text>
        <picker mode="selector" range="{{countryList}}" value="{{travelCountryIndex}}" bindchange="onCountryChange">
          <view class="travel-form-picker">{{countryList[travelCountryIndex] || 'è¯·é€‰æ‹©å›½å®¶'}}</view>
        </picker>
      </view>
      
      <view class="travel-form-row">
        <text class="travel-form-label">ç›®çš„åœ°åç§°</text>
        <input class="travel-form-input" placeholder="è¯·è¾“å…¥ç›®çš„åœ°åç§°/å¤‡æ³¨" value="{{travelFormName}}" bindinput="onTravelNameInput" />
      </view>
      
      <view class="travel-form-row travel-form-row-slider">
        <text class="travel-form-label">ä¼˜å…ˆçº§ (1-30)</text>
        <view class="travel-slider-wrap">
          <slider min="1" max="30" value="{{travelFormPriority}}" show-value="true" activeColor="#1890ff" bindchange="onTravelPriorityChange" />
        </view>
      </view>
      
      <view class="travel-form-btns">
        <button class="travel-form-btn travel-form-cancel" bindtap="cancelTravelForm">å–æ¶ˆ</button>
        <button class="travel-form-btn travel-form-submit" bindtap="submitTravelForm">ç¡®å®š</button>
      </view>
    </view>

    <!-- ç›®çš„åœ°åˆ—è¡¨ -->
    <view class="product-table">
      <view class="table-row table-header">
        <view class="table-cell" style="flex: 2;">ç›®çš„åœ°</view>
        <view class="table-cell" style="flex: 1;">ç±»å‹</view>
        <view class="table-cell" style="flex: 1;">ä¼˜å…ˆçº§</view>
      </view>
      
      <scroll-view scroll-y="true" class="table-scroll-view" wx:if="{{travelList.length}}">
        <view 
          wx:for="{{travelList}}" 
          wx:key="id" 
          class="swipe-row" 
          data-show="{{travelSwipeIndex == index}}"
        >
          <view class="swipe-actions">
            <button class="swipe-btn delete-btn" data-id="{{item.id}}" catchtap="onDeleteTravel">åˆ é™¤</button>
            <button class="swipe-btn update-btn" data-id="{{item.id}}" catchtap="onMarkVisited" wx:if="{{travelTab === 'pending'}}">âœ“ å·²å»</button>
          </view>
          <view 
            class="table-row product-card swipe-content"
            bindtouchstart="onTouchStartTravel"
            bindtouchmove="onTouchMoveTravel"
            bindtouchend="onTouchEndTravel"
            data-index="{{index}}"
          >
            <view class="table-cell name-cell" style="flex: 2;">
              <text class="product-name">{{item.displayName}}</text>
            </view>
            <view class="table-cell type-cell" style="flex: 1;">
              <text class="type-tag {{item.type === 'Domestic' ? 'type-domestic' : 'type-international'}}">{{item.type === 'Domestic' ? 'ğŸ‡¨ğŸ‡³' : 'ğŸŒ'}}</text>
            </view>
            <view class="table-cell" style="flex: 1;">
              <text class="priority-badge">{{item.priority}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <view class="empty-state" wx:if="{{!travelList.length}}">
        <text class="empty-icon">{{travelTab === 'pending' ? 'âœˆï¸' : 'ğŸ‰'}}</text>
        <text>{{travelTab === 'pending' ? 'æš‚æ— å¾…å‡ºè¡Œç›®çš„åœ°' : 'æš‚æ— å‡ºè¡Œè®°å½•'}}</text>
      </view>
    </view>
    
    <view class="add-btn-row" wx:if="{{travelTab === 'pending'}}">
      <view class="fab-btn" bindtap="showAddTravelForm">
        <text class="fab-btn-icon">+</text>
      </view>
    </view>
  </view>

  <!-- æ¨é€æ¶ˆæ¯å…¥å£ -->
  <view class="push-link">
    <navigator url="/pages/openid/openid" open-type="navigate" class="push-navigator">
      <text class="push-text">ğŸ”” æ¶ˆæ¯æ¨é€è®¾ç½®</text>
    </navigator>
  </view>
</view>
