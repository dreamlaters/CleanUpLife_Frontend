<!-- é¦–é¡µå±•ç¤ºç‰©å“åˆ—è¡¨å’Œæé†’åŠŸèƒ½ -->
<view class="container" xmlns:wx="http://www.w3.org/1999/xhtml">
	<!-- ç‰©å“è¡¨æ ¼ -->
	<view class="product-table">
		<!-- è¡¨å¤´ -->
		<view class="table-row table-header">
			<text class="table-cell" bindtap="onSortByName">
				<icon type="info" size="22" color="#1890ff"/> ç‰©å“åç§°
			</text>
			<text class="table-cell" bindtap="onSortByBestBy">
				<icon type="time" size="22" color="#faad14"/> ä¿è´¨æœŸ
			</text>
			<text class="table-cell">
				<icon type="location" size="22" color="#52c41a"/> å­˜æ”¾ä½ç½®
			</text>
		</view>
		<!-- æ•°æ®è¡Œï¼Œä½¿ç”¨scroll-viewåŒ…è£¹ -->
		<block wx:if="{{products.length}}">
			<scroll-view scroll-y="true" class="table-scroll-view">
				<block wx:for="{{products}}" wx:key="id">
					<view class="swipe-row" data-show="{{swipeIndex==index}}">
						<view class="swipe-actions">
							<button class="swipe-btn delete-btn" data-id="{{item.id}}" bindtap="onDelete">åˆ é™¤</button>
							<button class="swipe-btn update-btn" data-id="{{item.id}}" data-category="{{item.category}}" bindtap="onUpdate">æ›´æ–°</button>
						</view>
						<view class="table-row product-card swipe-content"
						  bindtouchstart="onTouchStart"
						  bindtouchmove="onTouchMove"
						  bindtouchend="onTouchEnd"
						  data-index="{{index}}">
							<view class="table-cell name-cell">
								<text class="product-name">{{item.name}} {{item.category === 'CatFood' ? 'ğŸ±' : item.category === 'Medicine' ? 'ğŸ’Š' : item.category === 'Food' ? 'ğŸ¥–' : ''}}</text>
							</view>
							<view class="table-cell">
								<!-- æ ¹æ®åç«¯è®¡ç®—çš„dateClassåŠ¨æ€è®¾ç½®æ ·å¼ -->
								<text class="product-date {{item.dateClass}}">{{item.bestByFormatted}}</text>
							</view>
							<view class="table-cell">
								<text class="location-tag">{{item.location.roomPlacement}}-{{item.location.site}}</text>
							</view>
						</view>
					</view>
				</block>
			</scroll-view>
		</block>
		<block wx:if="{{!products.length}}">
			<view class="table-row"><text class="table-cell">æš‚æ— æ•°æ®</text></view>
		</block>
	</view>

<!-- æ·»åŠ æ–°ç‰©å“æŒ‰é’® -->
	<view class="add-btn-row">
		<icon type="cancel" size="45" color="#1890ff" bindtap="goToTarget" />
	</view>

	<!-- æ–°å¢çš„å¾…è´­ç‰©å“è¡¨æ ¼ -->
	<view class="toBuy-section" style="margin-top: 40rpx;max-width: 700rpx;width:100%;">
		<view class="product-table">
			<!-- è¡¨å¤´ï¼šåç§° + ä¼˜å…ˆçº§ -->
			<view class="table-row table-header">
				<text class="table-cell" style="flex:none; width:70%;">å¾…è´­ç‰©å“åç§°</text>
				<text class="table-cell" style="flex:none; width:30%;">ä¼˜å…ˆçº§</text>
			</view>
			<block wx:if="{{toBuyProducts.length}}">
				<scroll-view scroll-y="true" class="table-scroll-view">
					<block wx:for="{{toBuyProducts}}" wx:key="id">
						<view class="swipe-row" data-show="{{toBuySwipeIndex==index}}">
							<view class="swipe-actions">
								<button class="swipe-btn delete-btn" data-id="{{item.id}}" bindtap="onDeleteToBuy">åˆ é™¤</button>
								<button class="swipe-btn update-btn" data-id="{{item.id}}" bindtap="onUpdateToBuy">æ›´æ–°</button>
							</view>
							<view class="table-row product-card swipe-content"
							  bindtouchstart="onTouchStartToBuy"
							  bindtouchmove="onTouchMoveToBuy"
							  bindtouchend="onTouchEndToBuy"
							  data-index="{{index}}">
								<view class="table-cell name-cell">
									<text class="product-name">{{item.name}}</text>
								</view>
								<view class="table-cell" style="flex:none; width:30%; min-width:120rpx;">
									<text>{{item.priority}}</text>
								</view>
							</view>
						</view>
					</block>
				</scroll-view>
			</block>
			<block wx:if="{{!toBuyProducts.length}}">
				<view class="table-row">
					<text class="table-cell">æš‚æ— å¾…è´­ç‰©å“</text>
				</view>
			</block>
		</view>
		<!-- æ–°å¢å¾…è´­ç‰©å“æŒ‰é’® -->
		<view class="add-btn-row" style="margin-top:20rpx;">
			<icon type="cancel" size="45" color="#1890ff" bindtap="goToAddToBuy" />
		</view>
	</view>

	<!-- å¾…å‡ºè¡Œæ¨¡å— -->
	<view class="travel-section" style="margin-top: 40rpx;max-width: 700rpx;width:100%;">
		<!-- Tabåˆ‡æ¢ -->
		<view class="travel-tabs">
			<view class="travel-tab {{travelTab === 'pending' ? 'travel-tab-active' : ''}}" bindtap="switchTravelTab" data-tab="pending">
				å¾…å‡ºè¡Œ
			</view>
			<view class="travel-tab {{travelTab === 'visited' ? 'travel-tab-active' : ''}}" bindtap="switchTravelTab" data-tab="visited">
				å·²å‡ºè¡Œ
			</view>
		</view>

		<!-- æ–°å¢å¾…å‡ºè¡Œç›®çš„åœ°åŒºåŸŸ -->
		<view class="travel-add-form" wx:if="{{showTravelForm}}">
			<view class="travel-form-row">
				<text class="travel-form-label">ç›®çš„åœ°ç±»å‹</text>
				<picker mode="selector" range="{{['å›½å†…', 'å›½å¤–']}}" value="{{travelFormTypeIndex}}" bindchange="onTravelTypeChange">
					<view class="travel-form-picker">{{travelFormTypeIndex === 0 ? 'å›½å†…' : 'å›½å¤–'}}</view>
				</picker>
			</view>
			<!-- å›½å†…é€‰æ‹©çœå¸‚ - ä½¿ç”¨å¾®ä¿¡å®˜æ–¹region pickerï¼Œlevel="sub-district"å¯é€‰çœå¸‚åŒºï¼Œlevel="city"åªé€‰çœå¸‚ -->
			<block wx:if="{{travelFormTypeIndex === 0}}">
				<view class="travel-form-row">
					<text class="travel-form-label">çœå¸‚</text>
					<picker mode="region" level="city" value="{{travelRegion}}" bindchange="onRegionChange">
						<view class="travel-form-picker">{{travelRegion[0] ? travelRegion.join('-') : 'è¯·é€‰æ‹©çœå¸‚'}}</view>
					</picker>
				</view>
			</block>
			<!-- å›½å¤–é€‰æ‹©å›½å®¶ -->
			<block wx:if="{{travelFormTypeIndex === 1}}">
				<view class="travel-form-row">
					<text class="travel-form-label">å›½å®¶</text>
					<picker mode="selector" range="{{countryList}}" value="{{travelCountryIndex}}" bindchange="onCountryChange">
						<view class="travel-form-picker">{{countryList[travelCountryIndex] || 'è¯·é€‰æ‹©å›½å®¶'}}</view>
					</picker>
				</view>
			</block>
			<view class="travel-form-row">
				<text class="travel-form-label">ç›®çš„åœ°åç§°</text>
				<input class="travel-form-input" placeholder="è¯·è¾“å…¥ç›®çš„åœ°åç§°/å¤‡æ³¨" value="{{travelFormName}}" bindinput="onTravelNameInput" />
			</view>
			<view class="travel-form-row travel-form-row-slider">
				<text class="travel-form-label">ä¼˜å…ˆçº§</text>
				<view class="travel-slider-wrap">
					<slider min="1" max="30" value="{{travelFormPriority}}" show-value="true" activeColor="#1890ff" bindchange="onTravelPriorityChange" />
				</view>
			</view>
			<view class="travel-form-btns">
				<button class="travel-form-btn travel-form-cancel" bindtap="cancelTravelForm">å–æ¶ˆ</button>
				<button class="travel-form-btn travel-form-submit" bindtap="submitTravelForm">ç¡®å®š</button>
			</view>
		</view>

		<!-- ç›®çš„åœ°åˆ—è¡¨ -->
		<view class="product-table">
			<view class="table-row table-header">
				<text class="table-cell" style="flex:none; width:50%;">ç›®çš„åœ°</text>
				<text class="table-cell" style="flex:none; width:25%;">ç±»å‹</text>
				<text class="table-cell" style="flex:none; width:25%;">ä¼˜å…ˆçº§</text>
			</view>
			<block wx:if="{{travelList.length}}">
				<scroll-view scroll-y="true" class="table-scroll-view">
					<block wx:for="{{travelList}}" wx:key="id">
						<view class="swipe-row" data-show="{{travelSwipeIndex==index}}">
							<view class="swipe-actions">
								<button class="swipe-btn delete-btn" data-id="{{item.id}}" bindtap="onDeleteTravel">åˆ é™¤</button>
								<button class="swipe-btn update-btn" data-id="{{item.id}}" bindtap="onMarkVisited" wx:if="{{travelTab === 'pending'}}">å·²å‡ºè¡Œ</button>
							</view>
							<view class="table-row product-card swipe-content"
							  bindtouchstart="onTouchStartTravel"
							  bindtouchmove="onTouchMoveTravel"
							  bindtouchend="onTouchEndTravel"
							  data-index="{{index}}">
								<view class="table-cell name-cell" style="flex:none; width:50%;">
									<text class="product-name">{{item.displayName}}</text>
								</view>
								<view class="table-cell" style="flex:none; width:25%;">
									<text>{{item.type === 'Domestic' ? 'ğŸ‡¨ğŸ‡³å›½å†…' : 'ğŸŒå›½å¤–'}}</text>
								</view>
								<view class="table-cell" style="flex:none; width:25%;">
									<text>{{item.priority}}</text>
								</view>
							</view>
						</view>
					</block>
				</scroll-view>
			</block>
			<block wx:if="{{!travelList.length}}">
				<view class="table-row">
					<text class="table-cell">{{travelTab === 'pending' ? 'æš‚æ— å¾…å‡ºè¡Œç›®çš„åœ°' : 'æš‚æ— å·²å‡ºè¡Œè®°å½•'}}</text>
				</view>
			</block>
		</view>
		<!-- æ–°å¢å¾…å‡ºè¡Œç›®çš„åœ°æŒ‰é’® -->
		<view class="add-btn-row" style="margin-top:20rpx;" wx:if="{{travelTab === 'pending'}}">
			<icon type="cancel" size="45" color="#1890ff" bindtap="showAddTravelForm" />
		</view>
	</view>

	<!-- è·³è½¬åˆ°OpenIDé¡µé¢çš„é“¾æ¥ -->
	<view style="margin-top: 40rpx; text-align: center;">
		<navigator url="/pages/openid/openid" open-type="navigate">
			<text style="color: #1890ff; font-size: 32rpx; text-decoration: underline;">æ¨é€æ¶ˆæ¯</text>
		</navigator>
	</view>
</view>