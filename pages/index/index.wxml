<!-- 首页展示物品列表和提醒功能 -->
<view class="container" xmlns:wx="http://www.w3.org/1999/xhtml">
	<!-- 物品表格 -->
	<view class="product-table">
		<!-- 表头 -->
		<view class="table-row table-header">
			<text class="table-cell" bindtap="onSortByName">
				<icon type="info" size="22" color="#1890ff"/> 物品名称
			</text>
			<text class="table-cell" bindtap="onSortByBestBy">
				<icon type="time" size="22" color="#faad14"/> 保质期
			</text>
			<text class="table-cell">
				<icon type="location" size="22" color="#52c41a"/> 存放位置
			</text>
		</view>
		<!-- 数据行，使用scroll-view包裹 -->
		<block wx:if="{{products.length}}">
			<scroll-view scroll-y="true" class="table-scroll-view">
				<block wx:for="{{products}}" wx:key="id">
					<view class="swipe-row" data-show="{{swipeIndex==index}}">
						<view class="swipe-actions">
							<button class="swipe-btn delete-btn" data-id="{{item.id}}" bindtap="onDelete">删除</button>
							<button class="swipe-btn update-btn" data-id="{{item.id}}" data-category="{{item.category}}" bindtap="onUpdate">更新</button>
						</view>
						<view class="table-row product-card swipe-content"
						  bindtouchstart="onTouchStart"
						  bindtouchmove="onTouchMove"
						  bindtouchend="onTouchEnd"
						  data-index="{{index}}">
							<view class="table-cell name-cell">
								<text class="product-name">{{item.name}} {{item.category === 'CatFood' ? '🐱' : item.category === 'Medicine' ? '💊' : item.category === 'Food' ? '🥖' : ''}}</text>
							</view>
							<view class="table-cell">
								<!-- 根据后端计算的dateClass动态设置样式 -->
								<text class="product-date {{item.dateClass}}">{{item.bestByFormatted}}</text>
							</view>
							<view class="table-cell">
								<text class="location-tag">{{item.location.roomPlacement}}-{{item.location.site}}</text>
							</view>
						</view>
					</view>
				</block>
			</scroll-view>
		</block>
		<block wx:if="{{!products.length}}">
			<view class="table-row"><text class="table-cell">暂无数据</text></view>
		</block>
	</view>

<!-- 添加新物品按钮 -->
	<view class="add-btn-row">
		<icon type="cancel" size="45" color="#1890ff" bindtap="goToTarget" />
	</view>

	<!-- 新增的待购物品表格 -->
	<view class="toBuy-section" style="margin-top: 40rpx;max-width: 700rpx;width:100%;">
		<view class="product-table">
			<!-- 表头：名称 + 优先级 -->
			<view class="table-row table-header">
				<text class="table-cell" style="flex:none; width:70%;">待购物品名称</text>
				<text class="table-cell" style="flex:none; width:30%;">优先级</text>
			</view>
			<block wx:if="{{toBuyProducts.length}}">
				<scroll-view scroll-y="true" class="table-scroll-view">
					<block wx:for="{{toBuyProducts}}" wx:key="id">
						<view class="swipe-row" data-show="{{toBuySwipeIndex==index}}">
							<view class="swipe-actions">
								<button class="swipe-btn delete-btn" data-id="{{item.id}}" bindtap="onDeleteToBuy">删除</button>
								<button class="swipe-btn update-btn" data-id="{{item.id}}" bindtap="onUpdateToBuy">更新</button>
							</view>
							<view class="table-row product-card swipe-content"
							  bindtouchstart="onTouchStartToBuy"
							  bindtouchmove="onTouchMoveToBuy"
							  bindtouchend="onTouchEndToBuy"
							  data-index="{{index}}">
								<view class="table-cell name-cell">
									<text class="product-name">{{item.name}}</text>
								</view>
								<view class="table-cell" style="flex:none; width:30%; min-width:120rpx;">
									<text>{{item.priority}}</text>
								</view>
							</view>
						</view>
					</block>
				</scroll-view>
			</block>
			<block wx:if="{{!toBuyProducts.length}}">
				<view class="table-row">
					<text class="table-cell">暂无待购物品</text>
				</view>
			</block>
		</view>
		<!-- 新增待购物品按钮 -->
		<view class="add-btn-row" style="margin-top:20rpx;">
			<icon type="cancel" size="45" color="#1890ff" bindtap="goToAddToBuy" />
		</view>
	</view>
	<!-- 跳转到OpenID页面的链接 -->
	<view style="margin-top: 40rpx; text-align: center;">
		<navigator url="/pages/openid/openid" open-type="navigate">
			<text style="color: #1890ff; font-size: 32rpx; text-decoration: underline;">推送消息</text>
		</navigator>
	</view>
</view>