<!-- é¦–é¡µ - ç°ä»£åŒ–è®¾è®¡ -->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">CleanUpLife</text>
    <text class="page-subtitle">æ•´ç†ç”Ÿæ´»ï¼Œä»è¿™é‡Œå¼€å§‹ âœ¨</text>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-container">
    <view class="stat-card stat-card-primary">
      <view class="stat-icon stat-icon-primary">ğŸ“¦</view>
      <text class="stat-value">{{products.length}}</text>
      <text class="stat-label">ç‰©å“æ€»æ•°</text>
    </view>
    <view class="stat-card stat-card-warning">
      <view class="stat-icon stat-icon-warning">â°</view>
      <text class="stat-value">{{expiringSoonCount}}</text>
      <text class="stat-label">å³å°†è¿‡æœŸ</text>
    </view>
    <view class="stat-card stat-card-danger">
      <view class="stat-icon stat-icon-danger">âš ï¸</view>
      <text class="stat-value">{{expiredCount}}</text>
      <text class="stat-label">å·²è¿‡æœŸ</text>
    </view>
  </view>

  <!-- ç‰©å“ç®¡ç†åŒºåŸŸ -->
  <view class="section-card">
    <view class="section-header">
      <view class="section-title-wrap">
        <view class="section-icon section-icon-products">ğŸ“¦</view>
        <text class="section-title">æˆ‘çš„ç‰©å“</text>
      </view>
      <view class="section-badge" wx:if="{{products.length}}">{{products.length}}ä»¶</view>
    </view>
    
    <!-- ç­›é€‰æ ‡ç­¾ -->
    <scroll-view scroll-x class="filter-scroll" wx:if="{{products.length}}">
      <view class="filter-tabs">
        <view class="filter-tab {{currentFilter === 'all' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="all">å…¨éƒ¨</view>
        <view class="filter-tab {{currentFilter === 'Food' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="Food">ğŸ¥– é£Ÿç‰©</view>
        <view class="filter-tab {{currentFilter === 'CatFood' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="CatFood">ğŸ± çŒ«ç²®</view>
        <view class="filter-tab {{currentFilter === 'Medicine' ? 'filter-tab-active' : ''}}" 
              bindtap="onFilterChange" data-filter="Medicine">ğŸ’Š è¯å“</view>
      </view>
    </scroll-view>

    <!-- ç‰©å“åˆ—è¡¨ - å¡ç‰‡å¼å¸ƒå±€ -->
    <view class="item-list" wx:if="{{filteredProducts.length}}">
      <view 
        class="item-card-wrapper"
        wx:for="{{filteredProducts}}" 
        wx:key="id"
      >
        <view 
          class="item-card"
          data-id="{{item.id}}"
          data-category="{{item.category}}"
          bindtap="onUpdate"
          bindlongpress="showItemActions"
        >
          <view class="item-emoji">{{item.emoji || 'ğŸ“¦'}}</view>
          <view class="item-content">
            <text class="item-name">{{item.name}}</text>
            <view class="item-info">
              <text class="item-location">ğŸ“ {{item.location.roomPlacement}}</text>
              <text class="item-date-badge {{item.dateClass}}">{{item.bestByFormatted}}</text>
            </view>
          </view>
          <text class="item-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!products.length}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-title">è¿˜æ²¡æœ‰æ·»åŠ ç‰©å“</text>
      <text class="empty-text">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå¼€å§‹è®°å½•ä½ çš„ç‰©å“</text>
      <view class="empty-btn" bindtap="goToTarget">+ æ·»åŠ ç‰©å“</view>
    </view>

    <!-- æ·»åŠ æŒ‰é’® -->
    <view class="add-btn-row" wx:if="{{products.length}}">
      <view class="fab-btn" bindtap="goToTarget">
        <text class="fab-btn-icon">+</text>
      </view>
    </view>
  </view>

  <!-- å¾…è´­ç‰©å“åŒºåŸŸ -->
  <view class="section-card">
    <view class="section-header">
      <view class="section-title-wrap">
        <view class="section-icon section-icon-tobuy">ğŸ›’</view>
        <text class="section-title">å¾…è´­æ¸…å•</text>
      </view>
      <view class="section-badge" wx:if="{{toBuyProducts.length}}">{{toBuyProducts.length}}ä»¶</view>
    </view>
    
    <!-- æœªå®Œæˆçš„å¾…è´­ç‰©å“ -->
    <view class="item-list" wx:if="{{toBuyPending.length}}">
      <view 
        class="item-card-wrapper"
        wx:for="{{toBuyPending}}" 
        wx:key="id"
      >
        <view 
          class="item-card tobuy-item"
          data-id="{{item.id}}"
          bindtap="onUpdateToBuy"
          bindlongpress="showToBuyActions"
        >
          <view class="tobuy-checkbox {{item.completed ? 'tobuy-checkbox-checked' : ''}}" 
                catchtap="toggleToBuyComplete" data-id="{{item.id}}">
            <text wx:if="{{item.completed}}">âœ“</text>
          </view>
          <view class="item-content {{item.completed ? 'item-completed' : ''}}">
            <text class="item-name">{{item.name}}</text>
            <view class="item-info">
              <view class="priority-indicator priority-{{item.priority <= 3 ? 'high' : item.priority <= 7 ? 'medium' : 'low'}}">
                <text>P{{item.priority}}</text>
              </view>
            </view>
          </view>
          <text class="item-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- å·²å®Œæˆçš„å¾…è´­ç‰©å“ï¼ˆå¯æŠ˜å ï¼‰ -->
    <view class="completed-section" wx:if="{{toBuyCompleted.length}}">
      <view class="completed-header" bindtap="toggleCompletedToBuyList">
        <view class="completed-title-wrap">
          <text class="completed-icon">âœ…</text>
          <text class="completed-title">å·²å®Œæˆ ({{toBuyCompleted.length}})</text>
        </view>
        <view class="completed-actions">
          <view class="clear-btn" catchtap="clearCompletedToBuy">æ¸…é™¤</view>
          <text class="expand-icon {{showCompletedToBuy ? 'expand-icon-up' : ''}}">â€º</text>
        </view>
      </view>
      <view class="completed-list {{showCompletedToBuy ? 'completed-list-show' : ''}}">
        <view 
          class="item-card-wrapper"
          wx:for="{{toBuyCompleted}}" 
          wx:key="id"
        >
          <view 
            class="item-card tobuy-item item-card-completed"
            data-id="{{item.id}}"
            bindtap="onUpdateToBuy"
            bindlongpress="showToBuyActions"
          >
            <view class="tobuy-checkbox tobuy-checkbox-checked" 
                  catchtap="toggleToBuyComplete" data-id="{{item.id}}">
              <text>âœ“</text>
            </view>
            <view class="item-content item-completed">
              <text class="item-name">{{item.name}}</text>
              <view class="item-info">
                <view class="priority-indicator priority-{{item.priority <= 3 ? 'high' : item.priority <= 7 ? 'medium' : 'low'}}">
                  <text>P{{item.priority}}</text>
                </view>
              </view>
            </view>
            <text class="item-arrow">â€º</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!toBuyProducts.length}}">
      <text class="empty-icon">ğŸ›’</text>
      <text class="empty-title">è´­ç‰©æ¸…å•æ˜¯ç©ºçš„</text>
      <text class="empty-text">è®°å½•éœ€è¦è´­ä¹°çš„ç‰©å“</text>
      <view class="empty-btn" bindtap="goToAddToBuy">+ æ·»åŠ å¾…è´­</view>
    </view>

    <view class="add-btn-row" wx:if="{{toBuyProducts.length}}">
      <view class="fab-btn fab-btn-success" bindtap="goToAddToBuy">
        <text class="fab-btn-icon">+</text>
      </view>
    </view>
  </view>

  <!-- å‡ºè¡Œç›®çš„åœ°åŒºåŸŸ -->
  <view class="section-card">
    <view class="section-header">
      <view class="section-title-wrap">
        <view class="section-icon section-icon-travel">âœˆï¸</view>
        <text class="section-title">å‡ºè¡Œè®¡åˆ’</text>
      </view>
      <view class="section-badge" wx:if="{{travelList.length}}">{{travelList.length}}ä¸ª</view>
    </view>
    
    <!-- Tabåˆ‡æ¢ -->
    <view class="travel-tabs">
      <view 
        class="travel-tab {{travelTab === 'pending' ? 'travel-tab-active' : ''}}" 
        bindtap="switchTravelTab" 
        data-tab="pending"
      >
        <text class="travel-tab-icon">ğŸ—ºï¸</text>
        <text>æƒ³å»çš„</text>
      </view>
      <view 
        class="travel-tab {{travelTab === 'visited' ? 'travel-tab-active' : ''}}" 
        bindtap="switchTravelTab" 
        data-tab="visited"
      >
        <text class="travel-tab-icon">âœ…</text>
        <text>å»è¿‡çš„</text>
      </view>
    </view>

    <!-- æ–°å¢è¡¨å• -->
    <view class="travel-add-form {{showTravelForm ? 'travel-form-show' : ''}}" wx:if="{{showTravelForm}}">
      <view class="travel-form-header">
        <text class="travel-form-title">âœ¨ æ·»åŠ ç›®çš„åœ°</text>
      </view>
      
      <view class="travel-form-row">
        <text class="travel-form-label">ç›®çš„åœ°ç±»å‹</text>
        <picker mode="selector" range="{{['ğŸ‡¨ğŸ‡³ å›½å†…', 'ğŸŒ å›½å¤–']}}" value="{{travelFormTypeIndex}}" bindchange="onTravelTypeChange">
          <view class="travel-form-picker">{{travelFormTypeIndex === 0 ? 'ğŸ‡¨ğŸ‡³ å›½å†…' : 'ğŸŒ å›½å¤–'}} <text class="picker-arrow">â–¼</text></view>
        </picker>
      </view>
      
      <!-- å›½å†…é€‰æ‹©çœå¸‚ -->
      <view class="travel-form-row" wx:if="{{travelFormTypeIndex === 0}}">
        <text class="travel-form-label">çœå¸‚</text>
        <picker mode="region" level="city" value="{{travelRegion}}" bindchange="onRegionChange">
          <view class="travel-form-picker">{{travelRegionDisplay || 'è¯·é€‰æ‹©çœå¸‚'}} <text class="picker-arrow">â–¼</text></view>
        </picker>
      </view>
      
      <!-- å›½å¤–é€‰æ‹©å›½å®¶ -->
      <view class="travel-form-row" wx:if="{{travelFormTypeIndex === 1}}">
        <text class="travel-form-label">å›½å®¶</text>
        <picker mode="selector" range="{{countryList}}" value="{{travelCountryIndex}}" bindchange="onCountryChange">
          <view class="travel-form-picker">{{countryList[travelCountryIndex] || 'è¯·é€‰æ‹©å›½å®¶'}} <text class="picker-arrow">â–¼</text></view>
        </picker>
      </view>
      
      <view class="travel-form-row">
        <text class="travel-form-label">ç›®çš„åœ°åç§°</text>
        <input class="travel-form-input" placeholder="è¯·è¾“å…¥ç›®çš„åœ°åç§°/å¤‡æ³¨" value="{{travelFormName}}" bindinput="onTravelNameInput" />
      </view>
      
      <view class="travel-form-row travel-form-row-slider">
        <text class="travel-form-label">æƒ³å»ç¨‹åº¦ 1-30</text>
        <view class="travel-slider-wrap">
          <slider min="1" max="30" value="{{travelFormPriority}}" show-value="true" activeColor="#667eea" block-color="#667eea" bindchange="onTravelPriorityChange" />
        </view>
      </view>
      
      <view class="travel-form-btns">
        <button class="travel-form-btn travel-form-cancel" bindtap="cancelTravelForm">å–æ¶ˆ</button>
        <button class="travel-form-btn travel-form-submit" bindtap="submitTravelForm">ç¡®å®šæ·»åŠ </button>
      </view>
    </view>

    <!-- ç›®çš„åœ°åˆ—è¡¨ -->
    <view class="item-list" wx:if="{{travelList.length}}">
      <view 
        class="item-card-wrapper"
        wx:for="{{travelList}}" 
        wx:key="id"
      >
        <view 
          class="item-card travel-item"
          data-id="{{item.id}}"
          bindlongpress="showTravelActions"
        >
          <view class="item-emoji travel-emoji">{{item.type === 'Domestic' ? 'ğŸ‡¨ğŸ‡³' : 'ğŸŒ'}}</view>
          <view class="item-content">
            <text class="item-name">{{item.displayName}}</text>
            <view class="item-info">
              <view class="travel-type-tag {{item.type === 'Domestic' ? 'travel-domestic' : 'travel-international'}}">
                {{item.type === 'Domestic' ? 'å›½å†…' : 'å›½é™…'}}
              </view>
              <view class="priority-indicator priority-travel" wx:if="{{travelTab !== 'visited'}}">
                <text>æƒ³å» {{item.priority}}</text>
              </view>
            </view>
          </view>
          <view class="travel-action-btn" catchtap="onMarkVisited" data-id="{{item.id}}" wx:if="{{travelTab === 'pending'}}">
            <text>âœ“ å»è¿‡äº†</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!travelList.length}}">
      <text class="empty-icon">{{travelTab === 'pending' ? 'âœˆï¸' : 'ğŸ‰'}}</text>
      <text class="empty-title">{{travelTab === 'pending' ? 'è¿˜æ²¡æœ‰æƒ³å»çš„åœ°æ–¹' : 'è¿˜æ²¡æœ‰å‡ºè¡Œè®°å½•'}}</text>
      <text class="empty-text">{{travelTab === 'pending' ? 'æ·»åŠ ä½ æ¢¦æƒ³ä¸­çš„ç›®çš„åœ°' : 'æŠŠæƒ³å»çš„åœ°æ–¹æ ‡è®°ä¸ºå·²å»è¿‡'}}</text>
      <view class="empty-btn" bindtap="showAddTravelForm" wx:if="{{travelTab === 'pending'}}">+ æ·»åŠ ç›®çš„åœ°</view>
    </view>
    
    <view class="add-btn-row" wx:if="{{travelTab === 'pending' && !showTravelForm && travelList.length}}">
      <view class="fab-btn fab-btn-info" bindtap="showAddTravelForm">
        <text class="fab-btn-icon">+</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨é“¾æ¥ -->
  <view class="footer-links">
    <navigator url="/pages/openid/openid" open-type="navigate" class="footer-link">
      <view class="footer-link-icon">ğŸ””</view>
      <text class="footer-link-text">æ¶ˆæ¯æ¨é€è®¾ç½®</text>
      <text class="footer-link-arrow">â€º</text>
    </navigator>
  </view>
</view>

<!-- æ“ä½œèœå• -->
<view class="action-sheet-mask {{showActionSheet ? 'show' : ''}}" bindtap="hideActionSheet"></view>
<view class="action-sheet {{showActionSheet ? 'show' : ''}}">
  <view class="action-sheet-header">
    <text class="action-sheet-title">{{actionSheetTitle}}</text>
  </view>
  <view class="action-sheet-item" bindtap="onActionEdit">
    <text class="action-icon">âœï¸</text>
    <text>ç¼–è¾‘</text>
  </view>
  <view class="action-sheet-item action-sheet-danger" bindtap="onActionDelete">
    <text class="action-icon">ğŸ—‘ï¸</text>
    <text>åˆ é™¤</text>
  </view>
  <view class="action-sheet-cancel" bindtap="hideActionSheet">
    <text>å–æ¶ˆ</text>
  </view>
</view>
